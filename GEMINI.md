# GEMINI.md

このファイルは、Gemini CLIがこのリポジトリで作業する際のガイダンスを提供します。

## 言語設定

- 常に日本語で応答してください
- コミットメッセージ、PRの説明も日本語で記述

---

## Python コーディング規約

### 型ヒント・データ構造
- 関数の引数と戻り値には必ず型ヒントを付ける
- 構造化データには `dict` ではなく **Pydanticの `BaseModel`** を使用する
- `Field` を使い、`description` や `examples` でメタデータを明記する
- `Any` の使用は避け、`Union` や `Optional` で明示する

### 変数・関数の命名
- 意味が明確な名前を使う（`d` ではなく `user_dict`）
- 略語は避ける（`cnt` ではなく `count`）
- bool変数は `is_`, `has_`, `can_` で始める

### リスト・辞書操作
- forループより内包表記を優先: `[x * 2 for x in items]`
- filterが必要な場合: `[x for x in items if x > 0]`
- 辞書生成: `{k: v for k, v in pairs}`
- 単純な変換には `map()` を検討

### エラーハンドリング
- 広すぎる `except Exception` は避ける
- 具体的な例外をキャッチ: `except ValueError, KeyError`
- エラーを握りつぶさず、ログ出力(logfire)または再raise
- 根本原因を修正せずtry-exceptで回避しない

### コード構造
- ネストは3階層以内に抑える（早期returnで解消）
- 1関数は1責務、長くなったら分割を検討
- マジックナンバーは定数化する

### コメント・ドキュメント
- 複雑なロジックには「なぜ」を説明するコメント
- docstringで関数の目的・引数・戻り値を記載

### セキュリティ
- SQLインジェクション対策（パラメータバインディング使用）
- ユーザー入力のバリデーション
- 機密情報のログ出力回避

---

## TypeScript コーディング規約

### 型安全性
- 適切な型定義を行う（interface, type aliasを使用）
- null/undefinedの安全な処理
- `any` と `unknown` の使用禁止（必ず具体的な型を定義する）

---

## React/TSX コーディング規約

### コロケーションパターン（必須）

関連するファイルは同じディレクトリにまとめて配置する:
- コンポーネント、フック、型定義、ユーティリティ、APIルートは機能単位で同一ディレクトリに配置
- **共有リソースは最小限に抑え、疎結合を維持する**
- 共有が必要な場合のみ `@/lib/` や `@/components/` に配置
- ディレクトリ構造で機能の境界を明確にする

```
app/
  users/
    page.tsx           # ページコンポーネント
    components/        # このページ専用のコンポーネント
    hooks/             # このページ専用のフック
    types.ts           # このページ専用の型定義
    api/               # このページ専用のAPIルート
```

### Import ルール（厳守）

**禁止事項:**
- `../../` 以上の相対importは禁止（コロケーションで解決）
- `@/app/...` 形式の絶対パスは禁止
- 他セクションのAPIをfetchしない

**許可されるimport:**
- `@/lib/...` と `@/components/...` のエイリアスは許可
- 同一セクション内の相対import（1階層まで）は許可
- 認証・セッション関連（`@/lib/auth`, `@/lib/session`）はセクション跨ぎ許可

### React コーディングパターン

**useEffect:**
- 内部で参照した変数・propsは必ず依存配列に含める
- setStateは関数型更新を使用して依存を避ける
- AbortControllerでクリーンアップを実装

**State リセット:**
- useEffectでのリセットは避け、key propパターンを使用

**useCallback:**
- useEffect内だけで使う関数には不要
- 子コンポーネントに渡す場合のみ使用

### 型安全性
- `any` と `unknown` の使用禁止（必ず具体的な型を定義する）
- `eslint-disable`の使用禁止
- 未使用変数は `_` prefixを付ける

### コメント
- 型定義、関数、useState、useEffect、複雑ロジックには日本語コメント必須

### セキュリティ
- APIでパスワード等の機密情報を返さない
- XSS対策（dangerouslySetInnerHTMLの使用確認）

---

## GitHub Actions

- シークレットの適切な使用
- 不要な権限がないか確認
- `${{ }}` 内でのシークレット漏洩リスクに注意

---

## Git ワークフロー

- `main` ブランチからfeatureブランチを作成
- コミットメッセージは簡潔で意味のある内容に
- コミットは小さく、原子的に保つ
